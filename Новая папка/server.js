// –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
const express = require('express');
const TelegramBot = require('node-telegram-bot-api');
const path = require('path');

// –ó–∞–ø—É—Å–∫–∞–µ–º Express-—Å–µ—Ä–≤–µ—Ä
const app = express();
const PORT = process.env.PORT || 3000;

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞, –ø–æ–¥—Å—Ç–∞–≤–∏–≤ –≤–∞—à —Ç–æ–∫–µ–Ω
const bot = new TelegramBot('8237574930:AAEVkJ_MadvH83M62o1vHXIa1BqZSQD8nuM', { polling: true });

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –¥–ª—è –±–æ—Ç–∞
bot.on('polling_error', (error) => {
  console.log('–û—à–∏–±–∫–∞ –ø–æ–ª–ª–∏–Ω–≥–∞:', error.code);
});

// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–µ—Ä–≤–µ—Ä –Ω–∞ —Ä–∞–∑–¥–∞—á—É —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–Ω–∞—à–µ–≥–æ HTML/CSS/JS)
app.use(express.static(path.join(__dirname, 'public')));

// –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∂–∏–≤
app.get('/', (req, res) => {
  res.send('üöÄ –°–µ—Ä–≤–µ—Ä SalonHelper –∑–∞–ø—É—â–µ–Ω! –ö–∞–ø–∏—Ç–∞–Ω, –º—ã –Ω–∞ —Å–≤—è–∑–∏!');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start –≤ Telegram
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const welcomeText = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SalonHelper! üèóÔ∏è

–í–∞—à–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–ª–æ–Ω–æ–º –∫—Ä–∞—Å–æ—Ç—ã –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.

‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏ –∏ —Ü–µ–Ω–∞–º–∏
‚Ä¢ –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
‚Ä¢ –ó–∞–ø–∏—Å—å –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
‚Ä¢ –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–∑–Ω–µ—Å–∞

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:`;

  // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –ê–ö–¢–£–ê–õ–¨–ù–´–ô URL –ò–ó LOCALHOST.RUN!
  const webAppUrl = 'https://2de4253dfdd43d.lhr.life';

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π, –æ—Ç–∫—Ä—ã–≤–∞—é—â–µ–π Mini App
  bot.sendMessage(chatId, welcomeText, {
    reply_markup: {
      inline_keyboard: [
        [{
          text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å SalonHelper',
          web_app: { url: webAppUrl }
        }]
      ]
    }
  });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
bot.onText(/\/help/, (msg) => {
  const chatId = msg.chat.id;
  const helpText = `‚ÑπÔ∏è –°–ø—Ä–∞–≤–∫–∞ –ø–æ SalonHelper:

–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:
‚Ä¢ üíÖ –£—Å–ª—É–≥–∏ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–π—Å–æ–º
‚Ä¢ üë• –ö–ª–∏–µ–Ω—Ç—ã - –±–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
‚Ä¢ üìÖ –ó–∞–ø–∏—Å–∏ - –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–ø–∏—Å–µ–π
‚Ä¢ üìä –û—Ç—á–µ—Ç—ã - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–∏–∑–Ω–µ—Å–∞
‚Ä¢ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–ª–æ–Ω–∞

–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.`;

  bot.sendMessage(chatId, helpText);
});

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
app.listen(PORT, () => {
  console.log(`\n‚ú® ======================================== ‚ú®`);
  console.log(`‚úÖ –°–µ—Ä–≤–µ—Ä SalonHelper –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
  console.log(`üëâ –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: http://localhost:${PORT}`);
  console.log(`ü§ñ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –≤ Telegram`);
  console.log(`üåê –í–Ω–µ—à–Ω–∏–π URL: https://2de4253dfdd43d.lhr.life`);
  console.log(`‚ú® ======================================== ‚ú®\n`);
});